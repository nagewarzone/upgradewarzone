<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>NAGE WARZONE  CRAFT/UPGRADE ITEMS</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .tabs button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #ddd; }
    .tabs button.active { background: #007BFF; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    input, button[type="submit"] { padding: 10px; width: 100%; margin-bottom: 10px; }
    button[type="submit"] { background: #007BFF; color: white; border: none; cursor: pointer; }
    p { white-space: pre-line; }
    #logoutBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 8px 12px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>

<h2>NANAGE WZRZONE  CRAFT/UPGRADE ITEMS</h2>

<div class="tabs">
  <button id="btnRegister">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button id="btnLogin" class="active">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button id="btnUpgrade" style="display:none;">‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°</button>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏° Logout -->
<button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

<!-- ‡πÅ‡∏™‡∏î‡∏á Token, TOPGM, Warzone -->
<div id="userStats" style="display:none; margin-bottom: 15px;">
  <strong>PEMTO:</strong> <span id="tokenCount">-</span> |
  <strong>‡∏õ‡∏•‡∏≠‡∏Å TOPGM:</strong> <span id="topgmCount">-</span> |
  <strong>‡πÇ‡∏•‡πà Warzone:</strong> <span id="warzoneCount">-</span> |
  <strong>POINT:</strong> <span id="POINT">-</span>
  <button id="btnAddTopgm" style="margin-left:10px; padding:3px 8px; font-size:14px; cursor:pointer;">+1 TOPGM (50 POINT)</button>
</div>

<div id="register" class="tab-content">
  <form id="registerForm">
    <input type="text" id="regUsername" placeholder="Username" required autocomplete="username" />
    <input type="password" id="regPassword" placeholder="Password" required autocomplete="new-password" />
    <input type="password" id="regConfirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required autocomplete="new-password" />
    <button type="submit">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <p id="registerResult"></p>
  </form>
</div>

<div id="login" class="tab-content active">
  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required autocomplete="username" />
    <input type="password" id="loginPassword" placeholder="Password" required autocomplete="current-password" />
    <button type="submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p id="loginResult"></p>
  </form>
</div>

<div id="upgrade" class="tab-content">
  <form id="upgradeForm">
    <input type="text" id="upgradeName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£" required autocomplete="off" />
    <button type="submit">‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°</button>
    <p id="upgradeResult"></p>
  </form>
</div>

<script>
  const apiURL = '';
  let loggedInUser = null;
  let loggedInPass = null;

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö
  function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');

    document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
    document.getElementById('btnRegister').classList.remove('active');
    document.getElementById('btnLogin').classList.remove('active');
    document.getElementById('btnUpgrade').classList.remove('active');

    if (tabName === 'register') document.getElementById('btnRegister').classList.add('active');
    else if (tabName === 'login') document.getElementById('btnLogin').classList.add('active');
    else if (tabName === 'upgrade') document.getElementById('btnUpgrade').classList.add('active');
  }

  document.getElementById('btnRegister').onclick = () => switchTab('register');
  document.getElementById('btnLogin').onclick = () => switchTab('login');
  document.getElementById('btnUpgrade').onclick = () => switchTab('upgrade');

  document.getElementById('logoutBtn').onclick = () => {
    localStorage.removeItem('username');
    localStorage.removeItem('password');
    loggedInUser = null;
    loggedInPass = null;
    document.getElementById('userStats').style.display = 'none';
    document.getElementById('btnUpgrade').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'none';
    switchTab('login');
  };

  async function loadUserStats() {
    const res = await fetch(apiURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'userinfo', username: loggedInUser, password: loggedInPass })
    });
    const data = await res.json();
    if (data.success) {
      document.getElementById('tokenCount').textContent = data.token;
      document.getElementById('topgmCount').textContent = data.topgm;
      document.getElementById('warzoneCount').textContent = data.warzone;
      document.getElementById('POINT').textContent = data.point || 0;
      document.getElementById('userStats').style.display = 'block';
    }
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  window.addEventListener('DOMContentLoaded', async () => {
    const user = localStorage.getItem('username');
    const pass = localStorage.getItem('password');
    if (user && pass) {
      loggedInUser = user;
      loggedInPass = pass;
      document.getElementById('btnUpgrade').style.display = 'inline-block';
      document.getElementById('logoutBtn').style.display = 'inline-block';
      switchTab('upgrade');
      await loadUserStats();
    }
  });

  // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  document.getElementById('loginForm').onsubmit = async e => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    const resultP = document.getElementById('loginResult');

    const res = await fetch(apiURL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'login', username, password })
    });
    const data = await res.json();

    if (data.success) {
      loggedInUser = username;
      loggedInPass = password;
      localStorage.setItem('username', username);
      localStorage.setItem('password', password);
      resultP.style.color = 'green';
      resultP.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
      document.getElementById('btnUpgrade').style.display = 'inline-block';
      document.getElementById('logoutBtn').style.display = 'inline-block';
      switchTab('upgrade');
      await loadUserStats();
    } else {
      resultP.style.color = 'red';
      resultP.textContent = data.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
    }
  };

  // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á)
  document.getElementById('registerForm').onsubmit = async e => {
    e.preventDefault();
    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regConfirmPassword').value;
    const resultP = document.getElementById('registerResult');

    if (password !== confirmPassword) {
      resultP.style.color = 'red';
      resultP.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
      return;
    }

    const res = await fetch(apiURL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'register', username, password })
    });
    const data = await res.json();

    if (data.success) {
      resultP.style.color = 'green';
      resultP.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
      // ‡∏≠‡∏≤‡∏à‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏ó‡πá‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      switchTab('login');
    } else {
      resultP.style.color = 'red';
      resultP.textContent = data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    }
  };

  document.getElementById('upgradeForm').onsubmit = async e => {
    e.preventDefault();
    
    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    const oldNotify = document.getElementById('upgradeNotification');
    if (oldNotify) oldNotify.remove();

    const name = document.getElementById('upgradeName').value.trim();
    const resultP = document.getElementById('upgradeResult');
    const upgradeButton = document.querySelector('#upgradeForm button[type="submit"]');
    const originalButtonText = upgradeButton.textContent;

    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    upgradeButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...';
    upgradeButton.disabled = true;
    resultP.innerHTML = `
      <div style="text-align: center;">
        <img src="https://img2.pic.in.th/pic/image_2025-05-21_180926572.png" 
             alt="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î" 
             style="width: 400px; margin-top: 10px;">
      </div>
    `;

    // ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    await new Promise(resolve => setTimeout(resolve, 3000));

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
    const res = await fetch(apiURL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'upgrade', username: loggedInUser, password: loggedInPass, name })
    });

    const data = await res.json();

    if (data.success) {
      let color, message, imageURL;

      switch(data.result) {
        case "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à":
          color = 'darkgreen';
          message = '‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß';
          imageURL = 'https://img2.pic.in.th/pic/image_2025-05-21_180922956.png';
          break;
        case "‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß":
          color = 'brown';
          message = '‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß... ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°';
          imageURL = 'https://img2.pic.in.th/pic/image_2025-05-21_180919249.png';
          break;
        case "‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡∏Å":
          color = 'red';
          message = '‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡∏Å! ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ üò¢';
          imageURL = 'https://img2.pic.in.th/pic/image_2025-05-21_180913699.png';
          break;
        default:
          color = 'black';
          message = '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö';
          imageURL = '';
          break;
      }

      resultP.style.color = color;
      resultP.innerHTML = `
        <strong>${message}</strong><br>
        <img src="${imageURL}" alt="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î" style="width: 300px; margin-top: 10px;">
      `;

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö popup
      const notify = document.createElement('div');
      notify.id = 'upgradeNotification';
      notify.style.position = 'fixed';
      notify.style.bottom = '20px';
      notify.style.right = '20px';
      notify.style.backgroundColor = color;
      notify.style.color = 'white';
      notify.style.padding = '15px';
      notify.style.borderRadius = '8px';
      notify.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
      notify.style.fontWeight = 'bold';
      notify.textContent = message;
      document.body.appendChild(notify);

      setTimeout(() => {
        notify.remove();
      }, 8000);

      // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
      await loadUserStats();

    } else {
      resultP.style.color = 'red';
      resultP.textContent = data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î';
    }

    upgradeButton.textContent = originalButtonText;
    upgradeButton.disabled = false;
  };

  // ‡πÄ‡∏û‡∏¥‡πà‡∏° TOPGM ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å POINT
  document.getElementById('btnAddTopgm').onclick = async () => {
    if (!loggedInUser) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
      return;
    }

    const res = await fetch(apiURL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'addtopgm', username: loggedInUser, password: loggedInPass })
    });

    const data = await res.json();

    if (data.success) {
      alert('‡πÅ‡∏•‡∏Å +1 TOPGM ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      await loadUserStats();
    } else {
      alert(data.message || '‡πÅ‡∏•‡∏Å TOPGM ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }
  };
</script>

</body>
</html>
